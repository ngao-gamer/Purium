-- =========================================================================
-- KHAI BÁO THƯ VIỆN & SERVICE CHUNG 
-- SỬ DỤNG FLUENT/PURIUM GUI (ĐÃ THỬ NGHIỆM TÍCH HỢP TỐT HƠN)
-- =========================================================================
local Fluent = loadstring(game:HttpGet("https://raw.githubusercontent.com/ngao-gamer/Purium/refs/heads/main/Purium%20Gui"))() 
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

local TeleportService = game:GetService("TeleportService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local Stats = game:GetService("Stats")
local Lighting = game:GetService("Lighting")
local Debris = game:GetService("Debris")
local LocalPlayer = Players.LocalPlayer
local IYMouse = LocalPlayer:GetMouse()

-- Biến toàn cục & Flags
local defaultJumpPower = 50 
local isHoppingForSmallServer = _G.isHoppingForSmallServer or false
local _G = _G or {} 
local notificationSettings = { power = true, roundTime = true, chain = true, artifact = true, airdrop = true, playSound = true }

-- Quản lý Thread & Connection
local staminaThread, combatStaminaThread, afkThread, scaleThread, antiGasThread = nil, nil, nil, nil, nil
local jumpConnection, infJumpConnection, espConnection, PlayersAddedConn, PlayersRemovingConn = nil, nil, nil, nil, nil
local staminaLoopActive, combatLoopActive, isScaling = false, false, false
local espElements = {} 
local noclipConnection = nil; local noclipEnabled = false
local BarrierDestroyerEnabled = false; local BarrierDestroyerTask = nil 
local FLYING = false; local iyflyspeed = 1; local flyKeyDown, flyKeyUp 
local isArtifactFarming = false; local artifactFarmingThread = nil 
local isFarming = false; local farmingThread = nil 
local hideEffectsActive = false 
local isFullbrightActive = false; local originalLightingProperties = {}; local originalEffectsState = {} 
local infGasResourceActive = false 
local valuesFolder, aiFolder, artifactsFolder, airDropsFolder = nil, nil, nil, nil
local updateConnection -- Dùng cho FPS/Ping
local showFPS = true; local showPing = true
local fpsLabel, pingLabel
local displayGui
local rainbowHue = 0.0 -- [MỚI] Biến theo dõi màu sắc cầu vồng

-- =========================================================================
-- LOGIC HIỂN THỊ FPS / PING (ĐÃ SỬA VÀ THÊM RAINBOW)
-- =========================================================================

local function setupDisplay()
    if displayGui and displayGui.Parent then return end

    displayGui = Instance.new("ScreenGui")
    displayGui.Name = "FPS_Ping_Display"
    displayGui.DisplayOrder = 999
    displayGui.IgnoreGuiInset = true

    -- FPS Label
    fpsLabel = Instance.new("TextLabel")
    fpsLabel.Name = "FPSLabel"
    fpsLabel.Size = UDim2.new(0, 200, 0, 20)
    fpsLabel.Position = UDim2.new(1, -5, 0, 5) -- Góc trên bên phải
    fpsLabel.AnchorPoint = Vector2.new(1, 0)
    fpsLabel.BackgroundTransparency = 1
    fpsLabel.TextColor3 = Color3.fromHSV(rainbowHue, 1, 1) -- Màu ban đầu (Đỏ)
    fpsLabel.TextStrokeTransparency = 0
    fpsLabel.Font = Enum.Font.SourceSansBold
    fpsLabel.TextScaled = true
    fpsLabel.TextXAlignment = Enum.TextXAlignment.Right
    fpsLabel.Text = "FPS: N/A"
    fpsLabel.Visible = showFPS
    fpsLabel.Parent = displayGui

    -- Ping Label
    pingLabel = Instance.new("TextLabel")
    pingLabel.Name = "PingLabel"
    pingLabel.Size = UDim2.new(0, 200, 0, 20)
    pingLabel.Position = UDim2.new(1, -5, 0, 30) -- Dưới FPS label
    pingLabel.AnchorPoint = Vector2.new(1, 0)
    pingLabel.BackgroundTransparency = 1
    pingLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    pingLabel.TextStrokeTransparency = 0
    pingLabel.Font = Enum.Font.SourceSansBold
    pingLabel.TextScaled = true
    pingLabel.TextXAlignment = Enum.TextXAlignment.Right
    pingLabel.Text = "Ping: N/A"
    pingLabel.Visible = showPing
    pingLabel.Parent = displayGui

    displayGui.Parent = CoreGui
end

local function startUpdateLoop()
    if updateConnection then return end
    
    setupDisplay() -- Đảm bảo UI được tạo

    -- [SỬA LỖI] Sử dụng deltaTime từ Heartbeat để tính toán chính xác
    updateConnection = RunService.Heartbeat:Connect(function(deltaTime) 
        pcall(function()
            
            -- Lấy FPS
            local fps = math.round(1 / deltaTime)

            if fpsLabel and showFPS then
                -- *** LOGIC 7 SẮC CẦU VỒ MỚI ***
                -- Thay đổi Hue liên tục (0.3 là tốc độ chuyển màu/giây)
                rainbowHue = rainbowHue + (deltaTime * 0.3) 
                if rainbowHue > 1 then 
                    rainbowHue = rainbowHue - 1 
                end
                
                fpsLabel.TextColor3 = Color3.fromHSV(rainbowHue, 1, 1)
                -- *** KẾT THÚC LOGIC 7 SẮC CẦU VỒ MỚI ***
                
                fpsLabel.Text = string.format("FPS: %d", fps)
            end
            
            -- Lấy Ping (Độ trễ)
            local networkStats = Stats:FindFirstChild("Network")
            local pingValue = networkStats and networkStats:FindFirstChild("Ping") and networkStats.Ping.Value or 0
            
            if pingLabel and showPing then
                pingLabel.Text = string.format("Ping: %d ms", math.round(pingValue * 1000))
            end
        end)
    end)
end

-- Khởi tạo và bắt đầu loop
task.spawn(function()
    setupDisplay()
    startUpdateLoop()
end)

-- =========================================================================
-- LOGIC TELEPORT CLICK & INIT PATHS (GIỮ NGUYÊN)
-- =========================================================================


_G.WRDClickTeleportEnabled = _G.WRDClickTeleportEnabled or false 
local connection = nil
local function handleTeleport(input, gameProcessed) 
    if gameProcessed then return end
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        if _G.WRDClickTeleportEnabled and UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) and LocalPlayer.Character and IYMouse.Hit then
            LocalPlayer.Character:MoveTo(Vector3.new(IYMouse.Hit.X, IYMouse.Hit.Y, IYMouse.Hit.Z))
        end
    end
end
if _G.WRDClickTeleportConnection == nil then
    connection = UserInputService.InputBegan:Connect(handleTeleport)
    _G.WRDClickTeleportConnection = connection
else
    connection = _G.WRDClickTeleportConnection
end

-- === KHAI BÁO BIẾN ĐƯỜNG DẪN CỤ THỂ ===
task.spawn(function() 
    pcall(function()
        local GameStuff = Workspace:WaitForChild("GameStuff", 10)
        local Misc = Workspace:WaitForChild("Misc", 10)
        valuesFolder = GameStuff and GameStuff:WaitForChild("Values", 5)
        aiFolder = Misc and Misc:WaitForChild("AI", 5)
        local Zones = Misc and Misc:WaitForChild("Zones", 5)
        local LootingItems = Zones and Zones:WaitForChild("LootingItems", 5)
        artifactsFolder = LootingItems and LootingItems:WaitForChild("Artifacts", 5)
        airDropsFolder = GameStuff and GameStuff:WaitForChild("GameSections", 5) and GameStuff.GameSections:FindFirstChild("AirDrops")
        
        -- KÍCH HOẠT SOUND KHI LOAD THÀNH CÔNG
        local sound = Instance.new("Sound"); sound.SoundId = "rbxassetid://100736080025788" 
        sound.Volume = 0.5; sound.Parent = Workspace; sound:Play(); Debris:AddItem(sound, 3)
    end)
end)

-- =========================================================================
-- LOGIC CÁC CHỨC NĂNG (MOVEMENT, COMBAT, AFK FIX, ESP, FARMING) (GIỮ NGUYÊN)
-- =========================================================================

local function toggleNoclip(enabled)
    local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid then return end

    if enabled then
        noclipEnabled = true
        humanoid.WalkSpeed = 0
        humanoid.JumpPower = 0
        noclipConnection = RunService.Heartbeat:Connect(function()
            if noclipEnabled and character then
                for _, part in ipairs(character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false; part.CanTouch = false
                    end
                end
            end
        end)
    else
        noclipEnabled = false
        if noclipConnection then noclipConnection:Disconnect(); noclipConnection = nil end
        humanoid.WalkSpeed = 16; humanoid.JumpPower = 50
        if character then
            for _, part in ipairs(character:GetDescendants()) do
                if part:IsA("BasePart") then
                    if part.Name ~= "HumanoidRootPart" then part.CanCollide = true; part.CanTouch = true end
                end
            end
        end
    end
end
local function getRoot(char) return char:FindFirstChild('HumanoidRootPart') or char:FindFirstChild('Torso') or char:FindFirstChild('UpperTorso') end
function sFLY()
    if FLYING then return end
	repeat task.wait() until LocalPlayer.Character and getRoot(LocalPlayer.Character) and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
	repeat task.wait() until IYMouse
	if flyKeyDown or flyKeyUp then flyKeyDown:Disconnect() flyKeyUp:Disconnect() end

	local T = getRoot(LocalPlayer.Character)
	local CONTROL = {F = 0, B = 0, L = 0, R = 0, Q = 0, E = 0}
	local lCONTROL = {F = 0, B = 0, L = 0, R = 0, Q = 0, E = 0}
	local SPEED = 0

	local function FLY()
		FLYING = true
		local BG = Instance.new('BodyGyro'); BG.P = 9e4; BG.Parent = T
		local BV = Instance.new('BodyVelocity'); BV.Parent = T
		BG.maxTorque = Vector3.new(9e9, 9e9, 9e9); BG.cframe = T.CFrame
		BV.velocity = Vector3.new(0, 0, 0); BV.maxForce = Vector3.new(9e9, 9e9, 9e9)
		task.spawn(function()
			repeat task.wait()
				if LocalPlayer.Character:FindFirstChildOfClass('Humanoid') then
					LocalPlayer.Character:FindFirstChildOfClass('Humanoid').PlatformStand = true
				end
				if CONTROL.L + CONTROL.R ~= 0 or CONTROL.F + CONTROL.B ~= 0 or CONTROL.Q + CONTROL.E ~= 0 then SPEED = 50
				elseif not (CONTROL.L + CONTROL.R ~= 0 or CONTROL.F + CONTROL.B ~= 0 or CONTROL.Q + CONTROL.E ~= 0) and SPEED ~= 0 then SPEED = 0 end
				if (CONTROL.L + CONTROL.R) ~= 0 or (CONTROL.F + CONTROL.B) ~= 0 or (CONTROL.Q + CONTROL.E) ~= 0 then
					BV.velocity = ((Workspace.CurrentCamera.CoordinateFrame.lookVector * (CONTROL.F + CONTROL.B)) + ((Workspace.CurrentCamera.CoordinateFrame * CFrame.new(CONTROL.L + CONTROL.R, (CONTROL.F + CONTROL.B + CONTROL.Q + CONTROL.E) * 0.2, 0).p) - Workspace.CurrentCamera.CoordinateFrame.p)) * SPEED * iyflyspeed
					lCONTROL = {F = CONTROL.F, B = CONTROL.B, L = CONTROL.L, R = CONTROL.R}
				elseif (CONTROL.L + CONTROL.R) == 0 and (CONTROL.F + CONTROL.B) == 0 and (CONTROL.Q + CONTROL.E) == 0 and SPEED ~= 0 then
					BV.velocity = ((Workspace.CurrentCamera.CoordinateFrame.lookVector * (lCONTROL.F + lCONTROL.B)) + ((Workspace.CurrentCamera.CoordinateFrame * CFrame.new(lCONTROL.L + lCONTROL.R, (lCONTROL.F + lCONTROL.B + CONTROL.Q + CONTROL.E) * 0.2, 0).p) - Workspace.CurrentCamera.CoordinateFrame.p)) * SPEED * iyflyspeed
				else BV.velocity = Vector3.new(0, 0, 0) end
				BG.cframe = Workspace.CurrentCamera.CoordinateFrame
			until not FLYING
			CONTROL = {F = 0, B = 0, L = 0, R = 0, Q = 0, E = 0}
			lCONTROL = {F = 0, B = 0, L = 0, R = 0, Q = 0, E = 0}
			SPEED = 0
			BG:Destroy(); BV:Destroy()
			if LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass('Humanoid') then
				LocalPlayer.Character:FindFirstChildOfClass('Humanoid').PlatformStand = false
			end
		end)
	end
	flyKeyDown = IYMouse.KeyDown:Connect(function(KEY)
		if KEY:lower() == 'w' then CONTROL.F = 1
		elseif KEY:lower() == 's' then CONTROL.B = -1
		elseif KEY:lower() == 'a' then CONTROL.L = -1
		elseif KEY:lower() == 'd' then CONTROL.R = 1
		elseif KEY:lower() == 'e' then CONTROL.Q = 1 
		elseif KEY:lower() == 'q' then CONTROL.E = -1
		end
	end)
	flyKeyUp = IYMouse.KeyUp:Connect(function(KEY)
		if KEY:lower() == 'w' then CONTROL.F = 0
		elseif KEY:lower() == 's' then CONTROL.B = 0
		elseif KEY:lower() == 'a' then CONTROL.L = 0
		elseif KEY:lower() == 'd' then CONTROL.R = 0
		elseif KEY:lower() == 'e' then CONTROL.Q = 0
		elseif KEY:lower() == 'q' then CONTROL.E = 0
		end
	end)
	FLY()
end
function NOFLY()
	FLYING = false
	if flyKeyDown or flyKeyUp then flyKeyDown:Disconnect(); flyKeyUp:Disconnect() end
	if LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass('Humanoid') then
		LocalPlayer.Character:FindFirstChildOfClass('Humanoid').PlatformStand = false
	end
end
local function destroyInvisibleBarriersLoop()
    while BarrierDestroyerEnabled do
        for _, part in ipairs(Workspace:GetDescendants()) do
            pcall(function()
                if part:IsA("BasePart") and part.Transparency == 1 and part.CanCollide == true then
                    local isPlayerPart = part.Parent and Players:GetPlayerFromCharacter(part.Parent)
                    if not isPlayerPart then part:Destroy() end
                end
            end)
        end
        task.wait(1.5)
    end
end
local function startInfGasWeaponResource()
    infGasResourceActive = true
    if antiGasThread and task.running(antiGasThread) then task.cancel(antiGasThread) end

    antiGasThread = task.spawn(function()
        while infGasResourceActive do
            task.wait(0.5) 
            pcall(function()
                local char = LocalPlayer.Character
                local statsFolder = char and char:FindFirstChild("Stats") 
                local gasResource = statsFolder and (statsFolder:FindFirstChild("SawGasValue") or statsFolder:FindFirstChild("SawGas") or statsFolder:FindFirstChild("Gas"))
                
                if gasResource and gasResource:IsA("NumberValue") then
                    gasResource.Value = 100 
                end
            end)
        end
    end)
end
local function stopInfGasWeaponResource()
    infGasResourceActive = false
    if antiGasThread and task.running(antiGasThread) then task.cancel(antiGasThread); antiGasThread = nil end
end

local function startInfiniteStamina_Fixed()
    if staminaLoopActive then return end
    staminaLoopActive = true
    
    if staminaThread and task.running(staminaThread) then 
        task.cancel(staminaThread) 
    end
    
    staminaThread = task.spawn(function()
        while staminaLoopActive do 
            task.wait(0.5) 
            pcall(function()
                local char = LocalPlayer.Character
                local statsFolder = char and char:FindFirstChild("Stats") 
                local staminaValue = statsFolder and statsFolder:FindFirstChild("Stamina")
                
                if staminaValue and staminaValue:IsA("NumberValue") then 
                    staminaValue.Value = 100 
                end
            end)
        end
    end)
end
local function stopInfiniteStamina_Fixed()
    staminaLoopActive = false 
    if staminaThread and task.running(staminaThread) then 
        task.cancel(staminaThread)
    end
    staminaThread = nil 
end

local function startInfCombatStamina()
    combatLoopActive = true
    if combatStaminaThread and task.running(combatStaminaThread) then task.cancel(combatStaminaThread) end
    combatStaminaThread = task.spawn(function()
        while combatLoopActive do task.wait(0.2) 
            pcall(function()
                local char = LocalPlayer.Character; local statsFolder = char and char:FindFirstChild("Stats")
                local combatStaminaValue = statsFolder and statsFolder:FindFirstChild("CombatStamina") 
                local dodgeValue = statsFolder and statsFolder:FindFirstChild("DodgeStamina") 
                if combatStaminaValue and combatStaminaValue:IsA("NumberValue") then combatStaminaValue.Value = 100 end
                if dodgeValue and dodgeValue:IsA("NumberValue") then dodgeValue.Value = 100 end
            end)
        end
    end)
end
local function stopInfCombatStamina()
    combatLoopActive = false 
    if combatStaminaThread and task.running(combatStaminaThread) then task.cancel(combatStaminaThread); combatStaminaThread = nil end
end
local function startInfJump()
    if infJumpConnection then infJumpConnection:Disconnect() end
    infJumpConnection = UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if input.KeyCode == Enum.KeyCode.Space and not gameProcessed then
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
                local humanoid = LocalPlayer.Character.Humanoid
                if humanoid.Health > 0 and humanoid.Sit == false then
                    humanoid:ChangeState(Enum.HumanoidStateType.Jumping); task.wait() 
                    humanoid:ChangeState(Enum.HumanoidStateType.Freefall) 
                end
            end
        end
    end)
end
local function stopInfJump()
    if infJumpConnection then infJumpConnection:Disconnect(); infJumpConnection = nil end
end

-- ANTI-AFK 19 MIN CLICK
local function startAntiAFK() 
    if afkThread and task.running(afkThread) then task.cancel(afkThread) end

    afkThread = task.spawn(function()
        while true do 
            task.wait(1140) -- 19 phút (19 * 60 = 1140 giây)
            
            pcall(function()
                -- Mô phỏng click chuột trái (LMB)
                IYMouse:Click() 
                -- Tùy chọn: Nhấn nút di chuyển nhỏ để giữ kết nối
                if LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
                    LocalPlayer.Character.Humanoid:Move(Vector3.new(0.01, 0, 0))
                    task.wait(0.1)
                    LocalPlayer.Character.Humanoid:Move(Vector3.new(0, 0, 0))
                end
                
                -- Thông báo Anti-AFK
                Fluent:Notify({ Title = "Anti AFK", Content = "Mô phỏng hành động để chống AFK (19 phút).", Duration = 3 })
            end)
        end
    end)
end
local function stopAntiAFK()
    if afkThread and task.running(afkThread) then task.cancel(afkThread); afkThread = nil end
end

-- Fullbright & FX Logic (GIỮ NGUYÊN)
local function applyFullbright(active) 
    isFullbrightActive = active
    if active then
        -- Lưu trữ trạng thái gốc của các hiệu ứng
        for _, effect in ipairs(Lighting:GetChildren()) do
            if effect:IsA("BlurEffect") or effect:IsA("ColorCorrectionEffect") or effect:IsA("BloomEffect") or effect:IsA("SunRaysEffect") or effect:IsA("DepthOfFieldEffect") then
                originalEffectsState[effect] = effect.Enabled
                effect.Enabled = false
            end
        end
        
        Lighting.Ambient = Color3.fromRGB(255, 255, 255)
        Lighting.OutdoorAmbient = Color3.fromRGB(255, 255, 255)
        Lighting.Brightness = 3
        Lighting.GlobalShadows = false
    else
        -- Khôi phục trạng thái gốc của các hiệu ứng
        for effect, wasEnabled in pairs(originalEffectsState) do
            if effect and effect.Parent == Lighting then
                effect.Enabled = wasEnabled
            end
        end
        originalEffectsState = {}
        
        -- Khôi phục giá trị mặc định của Lighting (giả định)
        Lighting.Ambient = Color3.fromRGB(0, 0, 0)
        Lighting.OutdoorAmbient = Color3.fromRGB(0, 0, 0)
        Lighting.Brightness = 2
        Lighting.GlobalShadows = true
    end
end
local function hideEffects(active)
    hideEffectsActive = active
    for _, effect in ipairs(Lighting:GetChildren()) do
        if effect:IsA("BlurEffect") or effect:IsA("ColorCorrectionEffect") or effect:IsA("BloomEffect") or effect:IsA("SunRaysEffect") or effect:IsA("DepthOfFieldEffect") then
            if active then
                originalEffectsState[effect] = effect.Enabled
                effect.Enabled = false
            else
                if originalEffectsState[effect] ~= nil then
                    effect.Enabled = originalEffectsState[effect]
                    originalEffectsState[effect] = nil
                end
            end
        end
    end
end

-- ESP LOGIC (GIỮ NGUYÊN)
local function cleanupPlayerEspElements(player)
    local elements = espElements[player]
    if elements then
        for _, element in pairs(elements) do
            if element and element.Parent then
                element:Destroy()
            end
        end
        espElements[player] = nil
    end
end
local function updatePlayerEspGui(player)
    local char = player.Character
    if not char then return end
    local elements = espElements[player]
    if not elements or not elements.NameLabel then return end

    local root = getRoot(char)
    if not root then return end
    local head = char:FindFirstChild("Head") or root

    local distance = math.floor((LocalPlayer.Character and getRoot(LocalPlayer.Character) and (getRoot(LocalPlayer.Character).Position - root.Position).Magnitude) or 0)
    local health = char:FindFirstChildOfClass("Humanoid") and math.floor(char:FindFirstChildOfClass("Humanoid").Health) or 0
    local isDead = health <= 0

    elements.NameLabel.Text = string.format("%s\n%dm\n%s Health", player.DisplayName, distance, health)
    
    local highlight = elements.Highlight
    if highlight then
        local color = Color3.fromHSV(math.max(0, health / 100 * (1/3)), 1, 1) -- Red to Green
        highlight.FillColor = color; highlight.OutlineColor = color
    end

    elements.NameLabel.Visible = not isDead
    if highlight then highlight.Enabled = not isDead end
    
    -- Tăng/Giảm kích thước BillboardGui
    local billGui = elements.BillboardGui
    if billGui then
        local scaleFactor = math.max(1, 100 / distance) * 0.5
        billGui.Size = UDim2.new(0, 100 * scaleFactor, 0, 50 * scaleFactor)
    end
end
local function startEspLogic()
    local function createPlayerEsp(player)
        local char = player.Character or player.CharacterAdded:Wait()
        local root = getRoot(char)
        if not root or char.Name == LocalPlayer.Name or espElements[player] then return end

        local elements = {}
        
        -- Highlight
        local highlight = Instance.new("Highlight")
        highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        highlight.FillColor = Color3.fromRGB(255, 255, 255); highlight.FillTransparency = 0.6
        highlight.OutlineColor = Color3.fromRGB(255, 255, 255); highlight.OutlineTransparency = 0
        highlight.Parent = char
        elements.Highlight = highlight

        -- BillboardGui cho Text
        local billGui = Instance.new("BillboardGui")
        billGui.Name = "PlayerESP_Text"; billGui.AlwaysOnTop = true; billGui.Size = UDim2.new(0, 100, 0, 50)
        billGui.ExtentsOffset = Vector3.new(0, 5, 0)
        billGui.Adornee = root -- Adornee HumanoidRootPart

        local nameLabel = Instance.new("TextLabel"); nameLabel.Name = "NameLabel"; nameLabel.Size = UDim2.new(1, 0, 1, 0); nameLabel.BackgroundTransparency = 1
        nameLabel.TextColor3 = Color3.new(1, 1, 1); nameLabel.TextStrokeTransparency = 0
        nameLabel.TextScaled = true; nameLabel.Font = Enum.Font.SourceSansBold
        nameLabel.Parent = billGui
        elements.NameLabel = nameLabel
        
        billGui.Parent = CoreGui
        elements.BillboardGui = billGui
        
        -- Cập nhật khi nhân vật thay đổi
        player.CharacterAdded:Connect(function(newChar)
            cleanupPlayerEspElements(player)
            createPlayerEsp(player)
        end)

        espElements[player] = elements
    end

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then createPlayerEsp(player) end
    end

    PlayersAddedConn = Players.PlayerAdded:Connect(createPlayerEsp)
    PlayersRemovingConn = Players.PlayerRemoving:Connect(cleanupPlayerEspElements)
    
    espConnection = RunService.Heartbeat:Connect(function()
        for player, elements in pairs(espElements) do
            updatePlayerEspGui(player)
        end
    end)
end
local function stopEspLogic()
    if espConnection then espConnection:Disconnect(); espConnection = nil end
    if PlayersAddedConn then PlayersAddedConn:Disconnect(); PlayersAddedConn = nil end
    if PlayersRemovingConn then PlayersRemovingConn:Disconnect(); PlayersRemovingConn = nil end
    for player, elements in pairs(espElements) do cleanupPlayerEspElements(player) end
    espElements = {}
end

-- AI ESP LOGIC (GIỮ NGUYÊN)
local aiEspElements = {}
local function createAIEsp(aiModel) 
    if not aiModel:IsA("Model") or not aiModel:FindFirstChildOfClass("Humanoid") or aiEspElements[aiModel] then return end 

    local highlight = Instance.new("Highlight")
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.FillColor = Color3.fromRGB(255, 0, 0); highlight.FillTransparency = 0.5 
    highlight.OutlineColor = Color3.fromRGB(255, 0, 0); highlight.OutlineTransparency = 0 
    highlight.Parent = aiModel 
    aiEspElements[aiModel] = highlight 
    
    aiModel.AncestryChanged:Connect(function(_, parent) 
        if not parent then 
            if highlight and highlight.Parent then highlight:Destroy() end 
            aiEspElements[aiModel] = nil 
        end 
    end) 
end 
local function startAIEsp() 
    if not aiFolder then return end 
    for _, child in ipairs(aiFolder:GetChildren()) do createAIEsp(child) end 
    aiFolder.ChildAdded:Connect(createAIEsp) 
end 
local function stopAIEsp() 
    for _, highlight in pairs(aiEspElements) do if highlight and highlight.Parent then highlight:Destroy() end end 
    aiEspElements = {} 
end 

-- ARTIFACT / SCRAP FARMING LOGIC (GIỮ NGUYÊN)
local function bringPlr(cframe) 
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then 
        LocalPlayer.Character:PivotTo(cframe * CFrame.new(0, 3, 0)) 
    end 
end 
local function artifactFarmLoop() 
    while isArtifactFarming do 
        if not artifactsFolder then task.wait(5); return end 
        local targetArtifact = nil 
        local smallestDistance = math.huge 
        for _, artifact in ipairs(artifactsFolder:GetChildren()) do 
            if artifact:IsA("Model") and artifact:FindFirstChild("PrimaryPart") then 
                local distance = (LocalPlayer.Character.HumanoidRootPart.Position - artifact.PrimaryPart.Position).Magnitude 
                if distance < smallestDistance then smallestDistance = distance; targetArtifact = artifact end 
            end 
        end 
        if targetArtifact then bringPlr(targetArtifact:GetPivot()); task.wait(0.3) else task.wait(5) end 
    end 
end 
local function farmLoop() 
    local LootFolders = Workspace:WaitForChild("Misc"):WaitForChild("Zones"):WaitForChild("LootingItems"):WaitForChild("Scrap", 5) 
    while isFarming do 
        if not LootFolders then task.wait(5); return end 
        local targetScrap = nil 
        local smallestDistance = math.huge 
        for _, scrap in ipairs(LootFolders:GetChildren()) do 
            if scrap:IsA("Model") and scrap:FindFirstChild("PrimaryPart") then 
                local distance = (LocalPlayer.Character.HumanoidRootPart.Position - scrap.PrimaryPart.Position).Magnitude 
                if distance < smallestDistance then smallestDistance = distance; targetScrap = scrap end 
            end 
        end 
        if targetScrap then bringPlr(targetScrap:GetPivot()); task.wait(0.3) else task.wait(5) end 
    end 
end 

-- =========================================================================
-- KHỞI TẠO UI & TABS
-- =========================================================================
local Window = Fluent:CreateWindow({
    Title = "Purium Hub [Premium] | Universal |",
    SubTitle = "Script Finalized (v6.4) - Rainbow FPS Fixed", -- Đã cập nhật SubTitle
    Search = true,
    Icon = "rbxassetid://121302760641013",
    TabWidth = 140,
    Size = UDim2.fromOffset(515, 350),
    Acrylic = true,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.RightAlt,

    UserInfo = true,
    UserInfoTop = false,
    UserInfoTitle = LocalPlayer.DisplayName,
    UserInfoSubtitle = "Premuim User",
    UserInfoSubtitleColor = Color3.fromRGB(71, 123, 255)
})
local Tabs = {
    Main0=Window:AddTab({ Title="Annoucenment", Icon = "info" }),
    Main1=Window:AddTab({ Title="Movement / Combat", Icon = "swords" }),
    Main2=Window:AddTab({ Title="Esp / Visuals", Icon = "user-plus"}),
    Notifications=Window:AddTab({ Title="Notifications", Icon = "bell-ring"}),
    AutoFarmTab=Window:AddTab({ Title="AutoFarm", Icon = "feather"}),
    Main4=Window:AddTab({ Title="Misc / Server", Icon = "cog"}),
    Main5=Window:AddTab({ Title="Environment", Icon = "sun"}),
    Main6=Window:AddTab({ Title="Execution / Utility", Icon = "terminal"}),
    Settings = Window:AddTab({ Title = "Settings", Icon = "settings" })
}

SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)
SaveManager:SetIgnoreIndexes({})
InterfaceManager:SetFolder("Purium HUB")
SaveManager:SetFolder("Purium HUB/universal")
InterfaceManager:BuildInterfaceSection(Tabs.Settings)
SaveManager:BuildConfigSection(Tabs.Settings)
Window:SelectTab(1)
Fluent:Notify({ 
Title = "Purium HUB",
Content = "Script Finalized (v6.4) - Rainbow FPS Fixed.",
Duration = 4 })
SaveManager:LoadAutoloadConfig()

Tabs.Main0:AddParagraph({ Title = "djtconmemaythgcho", Content = "duma co bug lam on vo discord sua chu dung chui tham t nua dm ngay bo hat xi 15 roi a." })
Tabs.Main0:AddButton({
    Title = "Discord",
    Description = "Join Ours discord for support",
    Callback = function()
      setclipboard("https://discord.gg/3fbA4kNZtJ")
      warn("Link Discord copied to clipboard: " .. "https://discord.gg/3fbA4kNZtJ") 
            game:GetService("StarterGui"):SetCore(
        "SendNotification",
        {
          Title = "Link Discord Copied!",
          Text = "Link Copied.",
          Duration = 2.5
        }
      )
    end
})

-- =========================================================================
-- NỘI DUNG TAB MOVEMENT / COMBAT (Main1) - ĐÃ SỬA LỖI CÚ PHÁP VÀ LOGIC
-- =========================================================================
Tabs.Main1:AddParagraph({ Title = "FPS / Ping Display", Content = "Hiển thị FPS và Ping." })
-- Đã kết nối các Toggle với logic display UI mới
Tabs.Main1:AddToggle("ShowFPSToggle", { 
    Title = "**Show FPS (Rainbow Effect)**", 
    Default = true, 
    Callback = function(val) 
        showFPS = val
        if fpsLabel then fpsLabel.Visible = val end 
        if val and not updateConnection then startUpdateLoop() end
    end
})

Tabs.Main1:AddToggle("ShowPingToggle", { 
    Title = "Show Ping", 
    Default = true, 
    Callback = function(val) 
        showPing = val
        if pingLabel then pingLabel.Visible = val end 
        if val and not updateConnection then startUpdateLoop() end
    end
})

local function setFPS(cap) if typeof(setfpscap) == "function" then pcall(function() setfpscap(cap) end) else warn("[FPS Unlocker] ❌ Hàm setfpscap không khả dụng.") end end 
Tabs.Main1:AddToggle("FPSUnlocker_Fixed", { 
    Title = "Unlock FPS", 
    Description = "Mở khóa giới hạn FPS (tối đa 9999).", 
    Default = false, 
}):OnChanged(function(Value) if Value then setFPS(9999) else setFPS(60) end end)

Tabs.Main1:AddSection("↳ Movement Exploits") 
Tabs.Main1:AddToggle("InfStaminaToggle_Fixed", { 
    Title = "Infinite Movement Stamina", 
    Description = "Hồi phục Stamina di chuyển tức thì (chạy nhanh).", 
    Default = false, 
}):OnChanged(function(value) if value then startInfiniteStamina_Fixed() else stopInfiniteStamina_Fixed() end end)

Tabs.Main1:AddToggle("InfCombatStaminaToggle", { 
    Title = "Infinite Combat/Dodge Stamina", 
    Description = "Hồi phục Combat Stamina và Dodge tức thì.", 
    Default = false, 
}):OnChanged(function(value) if value then startInfCombatStamina() else stopInfCombatStamina() end end)

Tabs.Main1:AddToggle("NoclipToggle", { 
    Title = "Noclip", 
    Description = "Đi xuyên vật thể/tường.", 
    Default = false, 
}):OnChanged(function(Value) toggleNoclip(Value) end)

Tabs.Main1:AddToggle("FlyToggle", { 
    Title = "Fly (W/A/S/D - Q/E)", 
    Description = "Bay lượn.", 
    Default = false, 
}):OnChanged(function(Value) if Value then sFLY() else NOFLY() end end)

Tabs.Main1:AddToggle("InfJumpToggle", { 
    Title = "Infinite Jump", 
    Description = "Nhảy không giới hạn.", 
    Default = false, 
}):OnChanged(function(Value) if Value then startInfJump() else stopInfJump() end end)

Tabs.Main1:AddToggle("InfGasToggle", { 
    Title = "Infinite Saw Gas / Weapon Resource", 
    Description = "Vũ khí không hết tài nguyên (xăng cưa/đạn).", 
    Default = false, 
}):OnChanged(function(Value) if Value then startInfGasWeaponResource() else stopInfGasWeaponResource() end end)


-- =========================================================================
-- NỘI DUNG TAB ESP / VISUALS (Main2) - ĐÃ SỬA LỖI CÚ PHÁP
-- =========================================================================
Tabs.Main2:AddToggle("PlayerChams_Toggle_FIXED_V4", { 
    Title = "Esp Players", 
    Description = "Chams (trắng, xuyên tường) và hiển thị tên/khoảng cách chính xác (BillboardGui).", 
    Default = false, 
}):OnChanged(function(Value) if Value == true then startEspLogic() else stopEspLogic() end end)

Tabs.Main2:AddToggle("AIEspToggle", { 
    Title = "AI ESP (Highlight Đỏ)", 
    Description = "Highlight các NPC/AI trên bản đồ.", 
    Default = false, 
}):OnChanged(function(Value) if Value then startAIEsp() else stopAIEsp() end end)

Tabs.Main2:AddToggle("ArtifactScalerToggle", { 
    Title = "Enlarge Artifacts(RỦI RO CAO)", 
    Description = "Làm cho Artifact lớn hơn (5x).", 
    Default = false, 
}):OnChanged(function(Value) 
    local function applyScaling(enabled) 
        isScaling = enabled 
        if scaleThread and task.running(scaleThread) then task.cancel(scaleThread) end 
        
        if isScaling then 
            scaleThread = task.spawn(function() 
                if not artifactsFolder then return end 
                local artifactModels = artifactsFolder:GetChildren()
                while isScaling do
                    for _, art in ipairs(artifactModels) do
                        pcall(function()
                            if art:IsA("Model") and art:FindFirstChild("PrimaryPart") then
                                art.PrimaryPart.Size = Vector3.new(25, 25, 25)
                                art.PrimaryPart.Massless = true 
                            end
                        end)
                    end
                    task.wait(5)
                end
            end)
        else
            -- Không có logic khôi phục kích thước ban đầu, chỉ dừng loop
        end
    end
    applyScaling(Value) 
end)

Tabs.Main2:AddToggle("HideEffectsToggle", {
    Title = "Hide Map/Game Effects", 
    Description = "Tắt Blur, Bloom, Color Correction, v.v. để tăng FPS/FPS-Boost.",
    Default = false, 
}):OnChanged(function(Value) hideEffects(Value) end)


-- =========================================================================
-- NỘI DUNG TAB NOTIFICATIONS - ĐÃ SỬA LỖI CÚ PHÁP
-- =========================================================================
Tabs.Notifications:AddParagraph({ Title = "Notification Settings", Content = "Bật/Tắt thông báo." })
Tabs.Notifications:AddToggle("NotifyPowerToggle_v4_EN", { 
    Title = "Notify: Low Power (30%)", 
    Default = notificationSettings.power, 
    Flag = "NotifyPowerToggle", 
    Callback = function(v) notificationSettings.power = v end 
})
Tabs.Notifications:AddToggle("NotifyRoundTimeToggle_v4_EN", { 
    Title = "Notify: End of Round (30s)", 
    Default = notificationSettings.roundTime, 
    Flag = "NotifyRoundTimeToggle", 
    Callback = function(v) notificationSettings.roundTime = v end 
})
Tabs.Notifications:AddToggle("NotifyChainToggle_v4_EN", { 
    Title = "Notify: CHAIN Spawn / Defeat", 
    Default = notificationSettings.chain, 
    Flag = "NotifyChainToggle", 
    Callback = function(v) notificationSettings.chain = v end 
})
Tabs.Notifications:AddToggle("NotifyArtifactToggle_v4_EN", { 
    Title = "Notify: Artifact Spawn", 
    Default = notificationSettings.artifact, 
    Flag = "NotifyArtifactToggle", 
    Callback = function(v) notificationSettings.artifact = v end 
})
Tabs.Notifications:AddToggle("NotifyAirdropToggle_v1_EN", { 
    Title = "Notify: Airdrop Spawn", 
    Default = notificationSettings.airdrop, 
    Flag = "NotifyAirdropToggle", 
    Callback = function(v) notificationSettings.airdrop = v end 
})
Tabs.Notifications:AddToggle("NotifySoundToggle_v4_EN", { 
    Title = "Notify: Play Sound", 
    Default = notificationSettings.playSound, 
    Flag = "NotifySoundToggle", 
    Callback = function(v) notificationSettings.playSound = v end 
})


-- =========================================================================
-- NỘI DUNG TAB AUTOFARM - ĐÃ SỬA LỖI CÚ PHÁP
-- =========================================================================
Tabs.AutoFarmTab:AddParagraph({ Title = "Auto Farming Functions", Content = "Tự động farm Artifacts và Scrap." })
Tabs.AutoFarmTab:AddToggle("ArtifactAutofarmToggle", { 
    Title = "AutoFarm Artifacts (Tự động lượm Artifact)", 
    Default = isArtifactFarming, 
    Flag = "ArtifactAutofarmToggle", 
    Callback = function(Value) 
        isArtifactFarming = Value 
        if isArtifactFarming then 
            if not artifactFarmingThread then 
                artifactFarmingThread = task.spawn(artifactFarmLoop) 
            end 
        else
            if artifactFarmingThread and task.running(artifactFarmingThread) then
                task.cancel(artifactFarmingThread); artifactFarmingThread = nil
            end
        end 
    end, 
})
Tabs.AutoFarmTab:AddToggle("ScrapAutofarmToggle", { 
    Title = "AutoFarm Scrap (Tự động lượm Scrap)", 
    Default = isFarming, 
    Flag = "ScrapAutofarmToggle", 
    Callback = function(Value) 
        isFarming = Value 
        if isFarming then 
            if not farmingThread then 
                farmingThread = task.spawn(farmLoop) 
            end 
        else
            if farmingThread and task.running(farmingThread) then
                task.cancel(farmingThread); farmingThread = nil
            end
        end 
    end,
})

-- Teleport button được giữ lại
Tabs.AutoFarmTab:AddButton({ 
    Title = "Teleport To Airdrop", 
    Description = "Dịch chuyển tới Airdrop gần nhất.", 
    Callback = function() 
        local allAirdrops = airDropsFolder and airDropsFolder:GetChildren() 
        if not allAirdrops or #allAirdrops == 0 then 
            Fluent:Notify({Title = "Mistake", Content = "Hiện không có Airdrop nào trên bản đồ.", Duration = 5, Icon = "box"}) 
            return 
        end 
        local targetAirdrop = allAirdrops[1] 
        local targetCFrame = targetAirdrop:GetPivot() 
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then 
            LocalPlayer.Character.HumanoidRootPart.CFrame = targetCFrame * CFrame.new(0, 10, 0) 
            Fluent:Notify({Title = "Intercepted!", Content = "Đã dịch chuyển tới Airdrop.", Duration = 5, Icon = "box"}) 
        else 
            Fluent:Notify({Title = "Mistake", Content = "Không tìm thấy HumanoidRootPart.", Duration = 5, Icon = "x"}) 
        end 
    end, 
})


-- =========================================================================
-- NỘI DUNG TAB MISC / SERVER (Main4) - ĐÃ SỬA LỖI CÚ PHÁP
-- =========================================================================
Tabs.Main4:AddParagraph({ Title = "Server Settings & Fixes", Content = "Các chức năng liên quan đến Server." })
Tabs.Main4:AddToggle("SmallServerHopToggle", {
    Title = "Look for a small server (less than 5 players)", 
    Description = "Tự động nhảy server cho đến khi tìm thấy server có ít hơn 5 người chơi.",
    Default = isHoppingForSmallServer, 
    Flag = "SmallServerHopToggle",
    Callback = function(Value)
        isHoppingForSmallServer = Value
        if isHoppingForSmallServer then
             Fluent:Notify({Title = "Search Engine Active", Content = "Đang tìm server với ít hơn 5 người chơi...", Duration = 6})
             
             if #Players:GetPlayers() < 5 then
                 Fluent:Notify({Title = "Found!", Content = "Server này đã có ít người chơi. Đã dừng tìm kiếm.", Duration = 5})
                 isHoppingForSmallServer = false
                 -- Tự động set lại Toggle
                 return
             end
             
             TeleportService:Teleport(game.PlaceId, LocalPlayer)
        else
            Fluent:Notify({Title = "Search Engine Stopped", Content = "Đã dừng tìm kiếm server nhỏ.", Duration = 5})
        end
    end,
})
Tabs.Main4:AddToggle("BarrierDestroyerToggle", {
    Title = "Destroy Invisible Barriers", 
    Description = "Xóa các khối vô hình (CanCollide=true, Transparency=1) gây cản trở.",
    Default = BarrierDestroyerEnabled, 
    Callback = function(Value)
        BarrierDestroyerEnabled = Value
        if BarrierDestroyerEnabled then
            if not BarrierDestroyerTask then
                BarrierDestroyerTask = task.spawn(destroyInvisibleBarriersLoop)
            end
        else
            if BarrierDestroyerTask and task.running(BarrierDestroyerTask) then
                task.cancel(BarrierDestroyerTask); BarrierDestroyerTask = nil
            end
        end
    end
})
Tabs.Main4:AddToggle("AntiAFKToggle", {
    Title = "Anti AFK (19 min Click)", 
    Description = "Mô phỏng hành động (click chuột) sau 19 phút để chống Kick AFK.",
    Default = false, 
}):OnChanged(function(Value) if Value then startAntiAFK() else stopAntiAFK() end end)


-- =========================================================================
-- NỘI DUNG TAB ENVIRONMENT (Main5) - ĐÃ SỬA LỖI CÚ PHÁP
-- =========================================================================
Tabs.Main5:AddParagraph({ Title = "Environment Tweaks", Content = "Các tùy chỉnh môi trường: Độ sáng, Sương mù." })
Tabs.Main5:AddToggle("FullbrightToggle", { 
    Title = "Fullbright", 
    Description = "Tăng độ sáng tối đa, loại bỏ bóng và một số hiệu ứng môi trường.", 
    Default = isFullbrightActive, 
    Flag = "FullbrightToggle",
    Callback = function(Value) 
        applyFullbright(Value)
    end
})
Tabs.Main5:AddToggle("AntiFogToggle", { 
    Title = "No Fog (Loại bỏ Sương mù)", 
    Description = "Giảm sương mù để nhìn rõ hơn.", 
    Default = false, 
    Flag = "AntiFogToggle",
    Callback = function(Value) 
        if Value then Lighting.FogEnd = 999999; Lighting.FogStart = 999998 else Lighting.FogEnd = 0; Lighting.FogStart = 0 end 
    end
}) 


-- =========================================================================
-- NỘI DUNG TAB EXECUTION / UTILITY (Main6) - ĐÃ SỬA LỖI CÚ PHÁP
-- =========================================================================
Tabs.Main6:AddParagraph({ Title = "Execution Scripts", Content = "Dùng để chạy các script ngoài." })
Tabs.Main6:AddButton({ 
    Title = "Infinite Yield", 
    Description = "Thực thi Infinite Yield.",
    Callback = function() 
        loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source'))()
        Fluent:Notify({ Title = "Execution", Content = "Đã thực thi Infinite Yield.", Duration = 3 })
    end 
})
Tabs.Main6:AddButton({ 
    Title = "Dex Explorer", 
    Description = "Thực thi Dex Explorer.",
    Callback = function() 
        loadstring(game:HttpGet("https://raw.githubusercontent.com/infyiff/backup/main/dex.lua"))()
        Fluent:Notify({ Title = "Execution", Content = "Đã thực thi DEX.", Duration = 3 })
    end 
})

Tabs.Main6:AddSection("↳ Utility Functions")
Tabs.Main6:AddToggle("ClickTeleportToggle", { 
    Title = "Click Teleport (Ctrl + Click)", 
    Description = "Nhấn giữ Ctrl + Click chuột để dịch chuyển.", 
    Default = _G.WRDClickTeleportEnabled, 
    Flag = "ClickTeleportToggle", 
    Callback = function(Value) 
        _G.WRDClickTeleportEnabled = Value
    end,
})

Tabs.Main6:AddButton({ 
    Title = "Respawn", 
    Description = "Tự tử và hồi sinh lại nhân vật.", 
    Callback = function() 
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then 
            LocalPlayer.Character.Humanoid.Health = 0 
            Fluent:Notify({ Title = "Respawn", Content = "Tự tử thành công.", Duration = 3 }) 
        end 
    end
})

Tabs.Main6:AddButton({ 
    Title = "ThirdPerson", 
    Description = "Thiết lập góc nhìn thứ 3 và zoom tối đa.",
    Callback = function() 
        game.Players.LocalPlayer.CameraMode = Enum.CameraMode.Classic 
        game.Players.LocalPlayer.CameraMaxZoomDistance = 1280 
        game.Players.LocalPlayer.CameraMinZoomDistance = 0.5
        Fluent:Notify({ Title = "Camera", Content = "Đã thiết lập góc nhìn thứ 3 và zoom tối đa.", Duration = 3 })
    end,
})

Tabs.Main6:AddButton({ 
    Title = "Remove Mask on head", 
    Description = "Xóa chiếc mặt nạ/bao bố trên đầu nhân vật.",
    Callback = function() 
        pcall(function()
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Sack") and LocalPlayer.Character.Sack:FindFirstChild("SurfaceAppearance") then
                LocalPlayer.Character.Sack.SurfaceAppearance.Parent:Destroy()
                Fluent:Notify({ Title = "Sack", Content = "Đã xóa Head Mask.", Duration = 3 })
            end
        end)
    end,
})

Tabs.Main6:AddButton({ 
    Title = "Destroy UI", 
    Description = "Đóng và xóa toàn bộ giao diện Script.",
    Callback = function() 
		Window:Destroy()
        if CoreGui:FindFirstChild("MinimizeUI") then CoreGui.MinimizeUI:Destroy() end
        if CoreGui:FindFirstChild("FPS_Ping_Display") then CoreGui.FPS_Ping_Display:Destroy() end
        
        -- Dừng các connection và thread
        stopEspLogic() 
        NOFLY()
        toggleNoclip(false)
        if updateConnection then updateConnection:Disconnect(); updateConnection = nil end -- Dừng loop FPS/Ping
        
        Fluent:Notify({Title = "UI Destroyed", Content = "Đã xóa giao diện script.", Duration = 3})
    end 
})
